<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.

-->
<htmlform>

    <ifMode mode="VIEW" include="false"><script type="text/javascript" src="../moduleResources/kenyaemr/scripts/moment.js"></script></ifMode>
    <ifMode mode="VIEW" include="false"><link rel="stylesheet" type="text/css" href="../moduleResources/kenyaemr/styles/kenyaemr_ml_scoring.css"></link></ifMode>
    <script type="text/javascript">
        var pAge = parseInt('<lookup expression="patient.age"/>');
        var pgender = "<lookup expression="patient.gender" />";
        var mlCaseFindingEnabled = "<lookup expression="fn.globalProperty('kenyaemrml.casefinding.feature.enabled')"/>";
        //On Ready
        $(document).ready(function () {
            //pop type
            jq('#div-ml-prediction').hide();

            //Consent validation
            jq('.consent input').change(consentSelected);

            //defaults
            jq("#key-population").hide();
            jq("#priority-population").hide();
            jq('#test-result').hide();
            jq('#tr-art-start-date').hide();
            jq('#positive-client').hide();
            jq('#tr-sexually-active').hide();
            jq('#tr-needle-stick').hide();
            jq('#tr-needle-shared').hide();
            jq('#tr-reasons-ineligibility').hide();
            jq('#experienced-physical-violence').hide();
            jq('#sex-againist-wish').hide();
            jq('#tbl-other-decline-reason').hide();
            jq('#screening-questions').hide();
            jq('#no-sex-partners input').prop('disabled', true);
            jq('#currently-prep input').prop('disabled', true);
            jq('#currently-pep input').prop('disabled', true);
            jq('#currently-sti input').prop('disabled', true);
            jq('#screened-tb input').prop('disabled', true);


            jq('#population-type :input[type=radio]').change(populationTypeSelected);
            jq('#test-history :input[type=radio]').change(everTested);
            jq('#mothers-hiv-status :input[type=radio]').change(motherTestStatus);
            jq('#health-worker :input[type=radio]').change(healthWorkerSelected);
            jq('#referred :input[type=radio]').change(referredSelected);
            jq('#ever-tested select').change(testResultsSelected);
            jq('#sexually-active').change(sexuallyActiveSelected);
            jq('#multiple-sex-partners').change(multipleSexualPartnersSelected);
            jq('#experienced-gbv').change(experiencedGBVSelected);
            jq('#prep-service :input[type=checkbox]').change(prepServiceSelected);
            jq('#pep-service :input[type=checkbox]').change(pepServiceSelected);
            jq('#sti-service :input[type=checkbox]').change(stiServiceSelected);
            jq('#tb-service :input[type=checkbox]').change(tbServiceSelected);
            jq('#pwid :input[type=checkbox]').change(pwidSelected);
            jq('#other-decline-reason :input[type=checkbox]').change(otherDeclineReasonSelected);
            jq('#index-relationship :input[type=checkbox]').change(indexRelationshipSelected);
            jq('#screened-tb :input[type=radio]').change(tbScreenedSelected);


            if(pgender == 'M' || pAge &lt; 10 ){
                jq("#department option[value='160538']").hide();  //PMTCT
             }else{
                jq("#department option[value='160538']").show();  //PMTCT
            }

            if(pAge &lt; 10 ){
               //Disable key and priority pop for under 10 yrs
                jq("#population-type input[value=164929]").prop("disabled",true);
                jq("#population-type input[value=138643]").prop("disabled",true);
                jq("#population-type input[value=164928]").prop("checked", true);
            }else{
                jq("#population-type input[value=164929]").prop("disabled",false);
                jq("#population-type input[value=138643]").prop("disabled",false);
                jq("#population-type input[value=164928]").prop("checked", false);
            }

            //TB screening validation
            var screeningRadios = jq('#screening-questions').find('input[type=radio]');
            screeningRadios.change(function() {
                tbResultsValidation();
            });

            var tbResultsValidation = function() {
                var tbScreeningResultsStatus = jq("#tb-result-status");
                const YES_CONCEPT_ID = 1065;
                const NO_CONCEPT_ID = 1066;
                var screeningYesResponses = [];
                var screeningNoResponses = [];
                jq.each(screeningRadios, function () {    //Fetch responses for the screening questions
//Push any responses to the respective screeningYesResponses and screeningNoResponses array
                    const COUGH = 159799;
                    const CONTACT = 124068;
                    const FEVER = 1494;
                    const WEIGHTLOSS = 832;
                    const SWEAT = 133027;
                    const LETHERGY = 116334;
//Push any responses to the respective screeningYesResponses and screeningNoResponses array
                    if ((this.value == COUGH || this.value == CONTACT || this.value == FEVER || this.value == WEIGHTLOSS || this.value == SWEAT || this.value == LETHERGY ) &amp;&amp; this.checked == true) {
                        screeningYesResponses.push(this);
                    }
                    if (this.value == NO_CONCEPT_ID &amp;&amp; this.checked == true) {
                        screeningNoResponses.push(this);
                    }
                });

                if (screeningYesResponses.length &gt; 0) { // presumed tb if any Yes response
                    jq("#tb-result-status input[value=142177]").prop("checked", true);
                }
                //Check if we have all NO responses
                if (screeningNoResponses.length &gt; 0 &amp;&amp; screeningYesResponses.length == 0 ) {
                    jq("#tb-result-status input[value=1660]").prop("checked", true);
                }
                //If no responses have been recorded then dont show any results
                if (screeningYesResponses.length == 0 &amp;&amp; screeningNoResponses.length == 0) {
                }
            }

        });

        var populationTypeSelected = function () {
            var val = jq(this).val();
            var keypop = jq('#key-population');
            var pripop = jq('#priority-population');
            if (val == 164929 ){
                jq("#key-population").show();
                jq("#priority-population").hide();
                clearHiddenSections(pripop);
            }
            if (val == 138643 ){
                jq("#priority-population").show();
                jq("#key-population").hide();
                clearHiddenSections(keypop);
            }
            if(val == 164928){
                jq("#key-population").hide();
                jq("#priority-population").hide();
                clearHiddenSections(keypop);
                clearHiddenSections(pripop);
            }
        }

        var motherTestStatus = function (){
            var val = jq(this).val();
            var testHistory = getValue('test-history.value');

            if (val == 703 &amp;&amp; testHistory == 1066 ){
                jq('#fs-risk-assessment').hide();
                jq('#fs-children-eligibility').hide();
                jq("#eligible-test input[value=1065]").prop("checked", true);
            }
            if(val == 664 || val == 1067) {
                jq('#fs-risk-assessment').show();
                jq('#fs-children-eligibility').show();
                jq("#eligible-test input[value=1065]").prop("checked", false);
            }

        }

        var everTested = function (){
            var val = jq(this).val();
            var mothersStatus = getValue('mothers-hiv-status.value');
            var testedBy = jq('#tester');
            var testResults = jq('#ever-tested');
            var testDate = jq('#date-tested');
            var artStartDate = jq('#started-art');
            var upn = jq('#upn-concept');

            if ((val == 1066 &amp;&amp; mothersStatus == 703) || val == 1066 ){
                clearHiddenSections(testDate);
                clearHiddenSections(testedBy);
                clearHiddenSections(testResults);
                clearHiddenSections(artStartDate);
                clearHiddenSections(upn);
                jq('#test-result').hide();
                jq('#tr-art-start-date').hide();
                jq('#positive-client').hide();
                jq('#positive-client').hide();
                jq('#fs-risk-assessment').hide();
                jq('#fs-children-eligibility').hide();
                jq("#eligible-test input[value=1065]").prop("checked", true);

            }
            if (val == 1065){
                jq('#fs-risk-assessment').show();
                jq('#fs-children-eligibility').show();
                jq("#eligible-test input[value=1065]").prop("checked", false);
                jq('#eligible-for-test').show();
                jq('#test-result').show();
                jq('#tr-art-start-date').show();
            }
        }

        var testResultsSelected = function (){
            var val = jq(this).val();
            var testDate = jq('#date-tested');
            var artStartDate = jq('#started-art');
            var upn = jq('#upn-concept');

            if (val == 664 ){
                jq('#date-tested :input').prop('disabled', false);
                jq('#started-art :input').prop('disabled', true);
                jq('#upn-concept :input').prop('disabled', true);
                jq('#positive-client').hide();
                jq('#fs-risk-assessment').show();
                jq('#fs-pregnancy-assessment').show();
                jq('#fs-children-eligibility').show();
                jq("#eligible-test input[value=1066]").prop("checked", false);
                clearHiddenSections(testDate);
                clearHiddenSections(artStartDate);
                clearHiddenSections(upn);

            }
            if (val == 703){
                jq('#positive-client').show();
                jq('#date-tested :input').prop('disabled', false);
                jq('#started-art :input').prop('disabled', false);
                jq('#upn-concept :input').prop('disabled', false);
                jq('#fs-risk-assessment').hide();
                jq('#fs-pregnancy-assessment').hide();
                jq('#fs-children-eligibility').hide();
                jq("#eligible-test input[value=1066]").prop("checked", true);

                clearHiddenSections(jq('#sexually-active'));
                clearHiddenSections(jq('#active-sexually'));
                clearHiddenSections(jq('#new-partner'));
                clearHiddenSections(jq('#active-sexually'));
                clearHiddenSections(jq('#partner-hiv-status'));
                clearHiddenSections(jq('#couple-discordant'));
                clearHiddenSections(jq('#multiple-sex-partners'));
                clearHiddenSections(jq('#no-sex-partners'));
                clearHiddenSections(jq('#alcoholic-sex'));
                clearHiddenSections(jq('#money-sex'));
                clearHiddenSections(jq('#condom-burst'));
                clearHiddenSections(jq('#stranger-sex'));
                clearHiddenSections(jq('#known-positive'));
                clearHiddenSections(jq('#experienced-gbv'));
                clearHiddenSections(jq('#sexual-violence'));
                clearHiddenSections(jq('#emotional-violence'));
                clearHiddenSections(jq('#physical-violence'));
                clearHiddenSections(jq('#prep-service'));
                clearHiddenSections(jq('#currently-prep'));
                clearHiddenSections(jq('#currently-pep'));
                clearHiddenSections(jq('#pep-service'));
                clearHiddenSections(jq('#sti-service'));
                clearHiddenSections(jq('#currently-sti'));
                clearHiddenSections(jq('#tb-service'));
                clearHiddenSections(jq('#screened-tb'));
                clearHiddenSections(jq('#scr-cough'));
                clearHiddenSections(jq('#scr-fever'));
                clearHiddenSections(jq('#scr-weight'));
                clearHiddenSections(jq('#scr-sweat'));
                clearHiddenSections(jq('#scr-contact'));
                clearHiddenSections(jq('#scr-lethergy'));
                clearHiddenSections(jq('#tb-result-status'));
                clearHiddenSections(jq('#needle-shared'));
                clearHiddenSections(jq('#needle-stick'));
                clearHiddenSections(jq('#scarification'));
                clearHiddenSections(jq('#malnutrition'));
                clearHiddenSections(jq('#growth-rate'));
                clearHiddenSections(jq('#infections'));
                clearHiddenSections(jq('#tb-infection'));
                clearHiddenSections(jq('#orphaned'));
                clearHiddenSections(jq('#parent-positive'));
                clearHiddenSections(jq('#prolonged-fever'));
                clearHiddenSections(jq('#still-breastfeering'));
            }
            if (val == 1067){
                jq('#positive-client').hide();
                jq('#date-tested :input').prop('disabled', true);
                jq('#started-art :input').prop('disabled', true);
                jq('#upn-concept :input').prop('disabled', true);
                jq('#fs-risk-assessment').show();
                jq('#fs-pregnancy-assessment').show();
                jq('#fs-children-eligibility').show();
                jq("#eligible-test input[value=1066]").prop("checked", false);
            }
        }

        var sexuallyActiveSelected = function(){
            var val = getValue('sexually-active.value');

            if(val == 'true'  &amp;&amp; pAge &gt; 10) {
                jq('#tr-sexually-active').show();
            }  else{
                jq('#tr-sexually-active').hide();
                clearHiddenSections(jq('#new-partner'));
                clearHiddenSections(jq('#active-sexually'));
                clearHiddenSections(jq('#partner-hiv-status'));
                clearHiddenSections(jq('#couple-discordant'));
                clearHiddenSections(jq('#multiple-sex-partners'));
                clearHiddenSections(jq('#no-sex-partners'));
                clearHiddenSections(jq('#alcoholic-sex'));
                clearHiddenSections(jq('#money-sex'));
                clearHiddenSections(jq('#condom-burst'));
                clearHiddenSections(jq('#stranger-sex'));
                clearHiddenSections(jq('#known-positive'));
            }
        }

        var multipleSexualPartnersSelected = function(){
            var val = getValue('multiple-sex-partners.value');

            if(val == 'true') {
                jq('#no-sex-partners input').prop('disabled', false);
            }  else{
                jq('#no-sex-partners input').prop('disabled', true);
                clearHiddenSections(jq('#no-sex-partners'));
            }
        }

        var experiencedGBVSelected = function(){
            var val = getValue('experienced-gbv.value');

            if(val == 1065) {
                jq('#experienced-physical-violence').show();
                jq('#sex-againist-wish').show();
            }  else{
                jq('#experienced-physical-violence').hide();
                jq('#sex-againist-wish').hide();
                clearHiddenSections(jq('#experienced-physical-violence'));
                clearHiddenSections(jq('#sex-againist-wish'));
            }
        }
        //Prep selected
        var prepServiceSelected = function(){
            var val = jq(this).val();
            var prepChecked = jq("#prep-service input:checkbox:checked");
            if(val == 1065 &amp;&amp; prepChecked.length >=1){
                jq('#currently-prep input').prop('disabled', false);
            }else{
                jq("#currently-prep input[value=1065]").prop("checked", false);
                jq("#currently-prep input[value=1066]").prop("checked", false);
                jq('#currently-prep input').prop('disabled', true);
            }
        }
        //Pep selected
        var pepServiceSelected = function(){
            var val = jq(this).val();
            var pepChecked = jq("#pep-service input:checkbox:checked");
            if(val == 1065 &amp;&amp; pepChecked.length >=1){
                jq('#currently-pep input').prop('disabled', false);
            }else{
                jq("#currently-pep input[value=false]").prop("checked", false);
                jq("#currently-pep input[value=true]").prop("checked", false);
                jq('#currently-pep input').prop('disabled', true);
            }
        }
        //Sti selected
        var stiServiceSelected = function(){
            var val = jq(this).val();
            var stiChecked = jq("#sti-service input:checkbox:checked");
            if(val == 1065 &amp;&amp; stiChecked.length >=1){
                jq('#currently-sti input').prop('disabled', false);
            }else{
                jq("#currently-sti input[value=1065]").prop("checked", false);
                jq("#currently-sti input[value=1066]").prop("checked", false);
                jq('#currently-sti input').prop('disabled', true);
            }
        }
        //TB selected
        var tbServiceSelected = function(){
            var val = jq(this).val();
            var tbChecked = jq("#tb-service input:checkbox:checked");
            if(val == 1065 &amp;&amp; tbChecked.length >=1){
                jq('#screened-tb input').prop('disabled', false);
            }else{
                jq("#screened-tb input[value=1065]").prop("checked", false);
                jq("#screened-tb input[value=1066]").prop("checked", false);
                jq('#screened-tb input').prop('disabled', true);
            }
        }
        //Health Worker Selected
        var healthWorkerSelected = function(){
            var val = jq(this).val();
            if(val == 1065){
                jq('#tr-needle-stick').show();
            }else{
                jq('#tr-needle-stick').hide();
                clearHiddenSections(jq('#needle-stick'));
            }
        }
        //PWID selected
        var pwidSelected = function(){
            var val = jq(this).val();
            var pwidChecked = jq("#pwid input:checkbox:checked");
            if(val == 105 &amp;&amp; pwidChecked.length >=1){
                jq('#tr-needle-shared').show();
            }else{
                jq('#tr-needle-shared').hide();
                clearHiddenSections(jq('#needle-shared'));
            }
        }
        //ReferredSelected for HTS Test selected
        var referredSelected = function(){
            var val = jq(this).val();

            if(val == 1066){
                jq('#tr-reasons-ineligibility').show();
            }else{
                jq('#tr-reasons-ineligibility').hide();
                clearHiddenSections(jq('#other-decline-reason'));
                clearHiddenSections(jq('#decline-testing'));
                clearHiddenSections(jq('#wants-partner'));
                clearHiddenSections(jq('#stigma'));
                clearHiddenSections(jq('#violent-partner'));
                clearHiddenSections(jq('#lack-counsellor'));
                clearHiddenSections(jq('#heavy-workload'));
                clearHiddenSections(jq('#too-sick'));
                clearHiddenSections(jq('#other-reason-specify'));
            }
        }
        //Other Decline Reason Selected
        var otherDeclineReasonSelected = function(){
            var val = jq(this).val();
            var otherChecked = jq("#other-decline-reason input:checkbox:checked");
            if(val == 5622 &amp;&amp; otherChecked.length >=1){
                jq('#tbl-other-decline-reason').show();
            }else{
                jq('#tbl-other-decline-reason').hide();
                clearHiddenSections(jq('#other-reason-specify'));
            }
        }
        var indexRelationshipSelected = function(){
            var val = jq(this).val();
            var relationshipChecked = jq("#index-relationship input:checkbox:checked");
            if(val == 1107 &amp;&amp; relationshipChecked.length ==1){
                jq("#index-relationship input[type=checkbox]").prop("disabled",true);
                jq(this).prop("disabled",false);
            }else {
                jq("#index-relationship input[type=checkbox]").prop("disabled",false);
                jq("#index-relationship input[value=1107]").prop("disabled",true);
            }
            if(relationshipChecked.length ==0){
                jq("#index-relationship input[value=1107]").prop("disabled",false);
            }
        }

        var tbScreenedSelected = function(){
            var val = jq(this).val();
            if(val == 1065){
                jq('#screening-questions').show();
            }else {
                jq('#screening-questions').hide();
            }
        }

        var consentSelected = function () {
            var val = jq(this).val();
            if (val == 'true' ){
                console.log("Testing Consent is given");
                jq('#couple-testing input').prop("disabled", false);
                jq('#hiv-test1-result select').prop("disabled", false);
                jq('.kit-name select').prop("disabled", false);
                jq('.lot-number input').prop("disabled", false);
                jq('#expiry-date input').prop("disabled", false);
                jq('#expiry-date2 input').prop("disabled", false);
                jq('#hiv-final-result select').prop("disabled", false);
                jq('.result-given select').prop("disabled", false);
                jq("#couple-discordant input").prop("disabled", false);
                jq("#tb-screening input").prop("disabled", false);

                if(mlCaseFindingEnabled === 'true') {
                    console.log("ML case finding is enabled. Enable score button");
		            jq('#div-ml-prediction').show();
                } else {
                    console.log("ML case finding is disabled. Disable score button");
                    jq('#div-ml-prediction').hide();
                }

            }
            if (val == 'false' ){
                console.log("Testing Consent is NOT given. ML disabled");
                jq('#couple-testing input').prop("disabled", true);
                jq('#hiv-test1-result select').prop("disabled", true);
                jq('.kit-name select').prop("disabled", true);
                jq('.lot-number input').prop("disabled", true);
                jq('#expiry-date input').prop("disabled", true);
                jq('#hiv-test2-result select').prop("disabled", true);
                jq('.kit-name2 select').prop("disabled", true);
                jq('.lot-number2 input').prop("disabled", true);
                jq('#expiry-date2 input').prop("disabled", true);
                jq('#hiv-final-result select').prop("disabled", true);
                jq('.result-given select').prop("disabled", true);
                jq("#couple-discordant input").prop("disabled", true);
                jq("#tb-screening input").prop("disabled", true);
                jq('#div-ml-prediction').hide();

                clearHiddenSections(jq('#tbl-couple-testing'));
                clearHiddenSections(jq('#hiv-test1-result'));
                clearHiddenSections(jq('.kit-name'));
                clearHiddenSections(jq('.lot-number'));
                clearHiddenSections(jq('#expiry-date'));
                clearHiddenSections(jq('#hiv-test2-result'));
                clearHiddenSections(jq('.kit-name2'));
                clearHiddenSections(jq('.lot-number2'));
                clearHiddenSections(jq('#expiry-date2'));
                clearHiddenSections(jq('#hiv-final-result'));
                clearHiddenSections(jq('.result-given'));
                clearHiddenSections(jq('#couple-discordant'));
                clearHiddenSections(jq('#tb-screening'));
            }
        }

        // handle ML prediction button
        jq("#btn-ml-prediction").click(function () {
            console.log("Prediction Button Clicked");
            var ctxPath = typeof openmrsContextPath === 'string' ? openmrsContextPath : OPENMRS_CONTEXT_PATH;
            var casefindingURL = "<lookup expression="fn.globalProperty('kenyaemrml.casefinding.endpoint')"/>";
            var latestMaritalStatus = "<lookup expression="fn.latestObs(1054).getValueCoded()"/>";
            var monthsSinceLastTest = getValue('date-tested.value');
            var populationType = getValue('population-type.value');
            var isDisabled = getValue('has-disability.value');
            var everTested = getValue("ever-tested.value");
            var testedAs = getValue("couple-testing.value");
            var entryPoint = getValue("department.value");
            var testStrategy = getValue("strategy.value");
            var tbScreening = getValue("tb-result-status.value");
            var selfTested = getValue("tester.value");
            var monthsSinceLastTestInt = parseInt(monthsSinceLastTest);

            var pwidChecked = jq("#pwid input:checkbox:checked");
            var mwsmChecked = jq("#mwsm input:checkbox:checked");
            var fswChecked = jq("#female-sex-worker input:checkbox:checked");
            var prisonerChecked = jq("#prisoner input:checkbox:checked");
            var transgenderChecked = jq("#transgender input:checkbox:checked");
            var kpotherChecked = jq("#kpother input:checkbox:checked");
            var pAge = parseInt('<lookup expression="patient.age"/>');

            if (populationType == '' || isDisabled == '' || everTested == '' || entryPoint == '' || testStrategy == '' || tbScreening == '' || selfTested == '' || testedAs == '') {
                console.log("Please ensure that you have provided answers to all questions above");
                jq('#ml-prediction-desc').html('Please ensure that you have provided answers to all questions above');
                return;
            }

            var predictionVariables = {
                Age: pAge,
                births: 0,
                pregnancies: 0,
                literacy: 0,
                poverty: 0,
                anc: 0,
                pnc: 0,
                sba: 0,
                hiv_prev: 0,
                hiv_count: 0,
                condom: 0,
                intercourse: 0,
                in_union: 0,
                circumcision: 0,
                partner_away: 0,
                partner_men: 0,
                partner_women: 0,
                sti: 0,
                fb: 0,
                PopulationTypeGP: 0,
                PopulationTypeKP: 0,
                PopulationTypePRIORITY: 0,
                KeyPopulationFSW: 0,
                KeyPopulationMSM: 0,
                KeyPopulationNR: 0,
                KeyPopulationOther: 0,
                KeyPopulationPWID: 0,
                PriorityPopulationAGYW: 0,
                PriorityPopulationFISHERMEN: 0,
                PriorityPopulationNR: 0,
                PriorityPopulationOTHER: 0,
                DepartmentEMERGENCY: 0,
                DepartmentIPD: 0,
                DepartmentOPD: 0,
                DepartmentPMTCT: 0,
                DepartmentVCT: 0,
                IsHealthWorkerNO: 0,
                IsHealthWorkerNR: 0,
                IsHealthWorkerYES: 0,
                SexuallyActiveNO: 0,
                SexuallyActiveNR: 0,
                SexuallyActiveYES: 0,
                NewPartnerNO: 0,
                NewPartnerNR: 0,
                NewPartnerYES: 0,
                PartnerHIVStatusNEGATIVE: 0,
                PartnerHIVStatusNR: 0,
                PartnerHIVStatusPOSITIVE: 0,
                PartnerHIVStatusUNKNOWN: 0,
                NumberOfPartnersMULTIPLE: 0,
                NumberOfPartnersNR: 0,
                NumberOfPartnersSINGLE: 0,
                AlcoholSexALWAYS: 0,
                AlcoholSexNEVER: 0,
                AlcoholSexNR: 0,
                AlcoholSexSOMETIMES: 0,
                MoneySexNO: 0,
                MoneySexNR: 0,
                MoneySexYES: 0,
                CondomBurstNO: 0,
                CondomBurstNR: 0,
                CondomBurstYES: 0,
                UnknownStatusPartnerNO: 0,
                UnknownStatusPartnerNR: 0,
                UnknownStatusPartnerYES: 0,
                KnownStatusPartnerNO: 0,
                KnownStatusPartnerNR: 0,
                KnownStatusPartnerYES: 0,
                PregnantNO: 0,
                PregnantNR: 0,
                PregnantYES: 0,
                BreastfeedingMotherNO: 0,
                BreastfeedingMotherNR: 0,
                BreastfeedingMotherYES: 0,
                ExperiencedGBVNO: 0,
                ExperiencedGBVYES: 0,
                CurrentlyOnPrepNO: 0,
                CurrentlyOnPrepNR: 0,
                CurrentlyOnPrepYES: 0,
                CurrentlyHasSTINO: 0,
                CurrentlyHasSTINR: 0,
                CurrentlyHasSTIYES: 0,
                SharedNeedleNO: 0,
                SharedNeedleNR: 0,
                SharedNeedleYES: 0,
                NeedleStickInjuriesNO: 0,
                NeedleStickInjuriesNR: 0,
                NeedleStickInjuriesYES: 0,
                TraditionalProceduresNO: 0,
                TraditionalProceduresNR: 0,
                TraditionalProceduresYES: 0,
                MothersStatusNEGATIVE: 0,
                MothersStatusNR: 0,
                MothersStatusPOSITIVE: 0,
                MothersStatusUNKNOWN: 0,
                ReferredForTestingNO: 0,
                ReferredForTestingYES: 0,
                GenderFEMALE: pgender == 'F' ? 1 : 0,
                GenderMALE: pgender == 'M' ? 1 : 0,
                MaritalStatusDIVORCED: 0,
                MaritalStatusMARRIED: 0,
                MaritalStatusMINOR: 0,
                MaritalStatusPOLYGAMOUS: 0,
                MaritalStatusSINGLE: 0,
                EverTestedForHivNO: 0,
                EverTestedForHivYES: 0,
                MonthsSinceLastTestLASTSIXMONTHS: 0,
                MonthsSinceLastTestMORETHANTWOYEARS: 0,
                MonthsSinceLastTestNR: 0,
                MonthsSinceLastTestONETOTWOYEARS: 0,
                MonthsSinceLastTestSEVENTOTWELVE: 0,
                ClientTestedAsCOUPLE: 0,
                ClientTestedAsINDIVIDUAL: 0,
                EntryPointIPD: 0,
                EntryPointOPD: 0,
                EntryPointOTHER: 0,
                EntryPointPEDIATRIC: 0,
                EntryPointPMTCT_ANC: 0,
                EntryPointPMTCT_MAT_PNC: 0,
                EntryPointTB: 0,
                EntryPointVCT: 0,
                EntryPointVMMC: 0,
                TestStrategyHB: 0,
                TestStrategyHP: 0,
                TestStrategyINDEX: 0,
                TestStrategyMO: 0,
                TestStrategyNP: 0,
                TestStrategyOTHER: 0,
                TestStrategySNS: 0,
                TestStrategyVI: 0,
                TestStrategyVS: 0,
                TbScreeningCONFIRMEDTB: 0,
                TbScreeningNOPRESUMEDTB: 0,
                TbScreeningPRESUMEDTB: 0,
                ClientSelfTestedNO: 0,
                ClientSelfTestedYES: 0,
                CoupleDiscordantNO: 0,
                CoupleDiscordantNR: 0,
                CoupleDiscordantYES: 0,
                SEXUALNO: 0,
                SEXUALYES: 0,
                SOCIALNO: 0,
                SOCIALYES: 0,
                NONENO: 0,
                NONEYES: 0,
                NEEDLE_SHARINGNO: 0,
                NEEDLE_SHARINGYES: 0,
                ReceivedPrEPNO: 0,
                ReceivedPrEPYES: 0,
                ReceivedPEPNO: 0,
                ReceivedPEPYES: 0,
                ReceivedTBNO: 0,
                ReceivedTBYES: 0,
                ReceivedSTINO: 0,
                ReceivedSTIYES: 0,
                GBVSexualNO: 0,
                GBVSexualYES: 0,
                GBVPhysicalNO: 0,
                GBVPhysicalYES: 0,
                GBVEmotionalNO: 0,
                GBVEmotionalYES: 0,
                dayofweekFRIDAY: 0,
                dayofweekMONDAY: 0,
                dayofweekSATURDAY: 0,
                dayofweekSUNDAY: 0,
                dayofweekTHURSDAY: 0,
                dayofweekTUESDAY: 0,
                dayofweekWEDNESDAY: 0
            };

            // convert marital status
            if (latestMaritalStatus == 5555) { // married monogamous
                predictionVariables.MaritalStatusMARRIED = 1;
            } else if (latestMaritalStatus == 159715) { // married polygamous
                predictionVariables.MaritalStatusPOLYGAMOUS = 1;
            } else if (latestMaritalStatus == 1058) { // divorced
                predictionVariables.MaritalStatusDIVORCED = 1;
            } else if (latestMaritalStatus == 1059 || latestMaritalStatus == 1057) { // widowed=single
                predictionVariables.MaritalStatusSINGLE = 1;
            }

            if (pAge &lt; 15) {
                predictionVariables.MaritalStatusMINOR = 1;
            }

            // convert population type
            if (populationType == 164928) {
                predictionVariables.PopulationTypeGP = 1;
            } else if (populationType == 164929) {
                predictionVariables.PopulationTypeKP = 1;
            } else if (populationType == 138643) {
                predictionVariables.PopulationTypePRIORITY = 1;
            }
            
            if (pwidChecked.length >=1) {
            	predictionVariables.KeyPopulationPWID = 1;
            }
            
            if (mwsmChecked.length >=1) {
            	predictionVariables.KeyPopulationMSM = 1;
            }
            
            if (fswChecked.length >=1) {
            	predictionVariables.KeyPopulationFSW = 1;
            }
            
            if (kpotherChecked.length >=1) {
            	predictionVariables.KeyPopulationOther = 1;
            }

            // convert ever tested for hiv status
            if (everTested == 1065) {
                predictionVariables.EverTestedForHivYES = 1;
            } else if (everTested == 1066) {
                predictionVariables.EverTestedForHivNO = 1;
            }

            // converter for tested as i.e. individual, couple:
            // TO-DO check field
            if (testedAs == 164957) {
                predictionVariables.ClientTestedAsINDIVIDUAL = 1;
            } else if (testedAs == 164958) {
                predictionVariables.ClientTestedAsCOUPLE = 1;
            }

            // convert entry point (department)
            
            if (entryPoint == 159940) { // VCT
                predictionVariables.EntryPointVCT = 1;
            } else if (entryPoint == 160542) { // OPD
                predictionVariables.EntryPointOPD = 1;
            } else if (entryPoint == 160456 || entryPoint == 1623) { // Maternity
                predictionVariables.EntryPointPMTCT_MAT_PNC = 1;
            } else if (entryPoint == 5485) { // IPD
                predictionVariables.EntryPointIPD = 1;
            } else if (entryPoint == 162181) { // Paed
                predictionVariables.EntryPointPEDIATRIC = 1;
            } else if (entryPoint == 5622 || entryPoint == 160552 || entryPoint == 162050 || entryPoint == 159938 || entryPoint == 159939 || entryPoint == 160546 || entryPoint == 160522 || entryPoint == 163096) { // Other
                predictionVariables.EntryPointOTHER = 1;
            } else if (entryPoint == 162223) { // vmmc
                predictionVariables.EntryPointVMMC = 1;
            } else if (entryPoint == 160541) { // tb
                predictionVariables.EntryPointTB = 1;
            } else if (entryPoint == 160538) { // ANC
                predictionVariables.EntryPointPMTCT_ANC = 1;
            }

            // convert months since last test

            if(monthsSinceLastTestInt &gt; 0) {
                if(monthsSinceLastTestInt &lt;= 6) {
                    predictionVariables.MonthsSinceLastTestLASTSIXMONTHS = 1;
                } else if(monthsSinceLastTestInt &gt;= 24) {
                    predictionVariables.MonthsSinceLastTestMORETHANTWOYEARS = 1;
                } else if(monthsSinceLastTestInt &gt;= 7 &amp;&amp; monthsSinceLastTestInt &lt;= 12) {
                    predictionVariables.MonthsSinceLastTestSEVENTOTWELVE = 1;
                } else if(monthsSinceLastTestInt &gt;= 12 &amp;&amp; monthsSinceLastTestInt &lt;= 24) {
                    predictionVariables.MonthsSinceLastTestONETOTWOYEARS = 1;
                }
            } else {
                predictionVariables.MonthsSinceLastTestNR = 1;
            }

            // convert testing strategy

            if (testStrategy == 159938) { // HB
                predictionVariables.TestStrategyHB = 1;
            } else if (testStrategy == 159939) { // Mobile
                predictionVariables.TestStrategyMO = 1;
            } else if (testStrategy == 164163) { // HP
                predictionVariables.TestStrategyHP = 1;
            } else if (testStrategy == 164953) { // NP
                predictionVariables.TestStrategyNP = 1;
            } else if (testStrategy == 164954) { // Integrated VCT sites
                predictionVariables.TestStrategyVI = 1;
            } else if (testStrategy == 164955) { // Stand Alone VCT center
                predictionVariables.TestStrategyVS = 1;
            } else if (testStrategy == 161557) { // INDEX
                predictionVariables.TestStrategyINDEX = 1;
            } else if (testStrategy == 5622) { // OTHER
                predictionVariables.TestStrategyOTHER = 1;
            } else if (testStrategy == 166606) { // SNS
                predictionVariables.TestStrategySNS = 1;
            }

            // convert HIV self test
            // 164952 - self tested
            if (selfTested == 5619) {
                predictionVariables.ClientSelfTestedNO = 1;
            } else if (selfTested == 164952) {
                predictionVariables.ClientSelfTestedYES = 1;
            }

            // convert TB screening

            if (tbScreening == 1660 || tbScreening == 160737) {
                predictionVariables.TbScreeningNOPRESUMEDTB = 1;
            } else if (tbScreening == 142177 || tbScreening == 1111) {
                predictionVariables.TbScreeningPRESUMEDTB = 1;
            } else if (tbScreening == 1496 || tbScreening == 1662) {
                predictionVariables.TbScreeningCONFIRMEDTB = 1;
            }

            var mlFormattedDate = moment(new Date()).format('YYYY-MM-DD');
            var modelConfigs = {
                "modelId":"hts_xgb_1211_jan_2023",
                "encounterDate":mlFormattedDate,
                "facilityId":"",
                "debug": "true"
            }
            var mlScoringRequestPayload = {
                modelConfigs: modelConfigs,
                variableValues: predictionVariables
            }

            console.log("Prediction Payload: " + JSON.stringify(mlScoringRequestPayload));

            var predResponse = '';
            if (casefindingURL !='') {
                jq.ajax({
                    url: '/' + ctxPath + casefindingURL,
                    type: "POST",
                    contentType: 'application/json',
                    data: JSON.stringify(mlScoringRequestPayload),
                    async: false,
                    success: function (response, textStatus, jqXHR) {
                        var probabilityForPositivity = response.result["probability(1)"];
                        console.log("Success. Got probability as: " + probabilityForPositivity);
                        var lowRiskThreshold = 0.002625179;
                        var mediumRiskThreshold = 0.010638781;
                        var highRiskThreshold = 0.028924102;

                        var highestRiskConcept = 167164;
                        var highRiskConcept = 1408;
                        var mediumRiskConcept = 1499;
                        var lowRiskConcept = 1407;

                        setValue('algorithm_result_score.value', probabilityForPositivity);

                        var className = jq('#ml-prediction-risk-category').attr("class");
                        if (probabilityForPositivity &gt; highRiskThreshold) {
                            jq('#ml-prediction-risk-category').html('Highest Risk Client');
                            jq('#ml-prediction-risk-category').removeClass(className);
                            jq('#ml-prediction-risk-category').addClass('ke-ml-very-high-risk');
                            jq('#ml-prediction-desc').html('This client has a very high probability of a HIV positive test result. Testing is strongly recommended');
                            setValue('algorithm_result_category.value', highestRiskConcept);
                        } else if (probabilityForPositivity &lt;= highRiskThreshold &amp;&amp; probabilityForPositivity &gt; mediumRiskThreshold) {
                            jq('#ml-prediction-risk-category').html('High Risk Client');
                            jq('#ml-prediction-risk-category').removeClass(className);
                            jq('#ml-prediction-risk-category').addClass('ke-ml-very-high-risk');
                            jq('#ml-prediction-desc').html('This client has a high probability of a HIV positive test result. Testing is strongly recommended');
                            setValue('algorithm_result_category.value', highRiskConcept);
                        } else if (probabilityForPositivity &lt;= mediumRiskThreshold &amp;&amp; probabilityForPositivity &gt; lowRiskThreshold ) {
                            jq('#ml-prediction-risk-category').html('Medium Risk Client');
                            jq('#ml-prediction-risk-category').removeClass(className);
                            jq('#ml-prediction-risk-category').addClass('ke-ml-medium-risk');
                            jq('#ml-prediction-desc').html('This client has a medium probability of a HIV positive test result. Testing is recommended');
                            setValue('algorithm_result_category.value', mediumRiskConcept);
                        } else if(probabilityForPositivity &lt;= lowRiskThreshold) {
                            jq('#ml-prediction-risk-category').html('Low Risk Client');
                            jq('#ml-prediction-risk-category').removeClass(className);
                            jq('#ml-prediction-risk-category').addClass('ke-ml-low-risk');
                            jq('#ml-prediction-desc').html('This client has a low probability of a HIV positive test result. Testing may not be recommended');
                            setValue('algorithm_result_category.value', lowRiskConcept);
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        var msg = '';
                        if (jqXHR.status == 500) {
                            msg = 'There was an internal Server Error [500].';
                        } else if (jqXHR.status == 404) {
                            msg = 'The requested service not found. [404]';
                        } else {
                            msg = 'System error: ' + jqXHR.responseText;
                        }
                        console.log("Error: " + msg);
                        jq('#ml-prediction-desc').html(msg);
                    }
                });
            }

        });

        //Before Submit
        beforeSubmit.push(function() {
            var popType = getValue('population-type.value');
            var department = getValue('department.value');
            var patientType = getValue('patient-type.value');
            var relationshipChecked = jq("#index-relationship input:checkbox:checked");
            var patientPregnant = getValue('pregnant.value');
            var healthWorker = getValue('health-worker.value');
            var needleStick = getValue('needle-stick.value');
            var testHistory = getValue('test-history.value');
            var mothersStatus = getValue('mothers-hiv-status.value');
            var everHadSex = getValue('sexually-active.value');
            var testStatus = getValue('ever-tested.value');
            var experiencedGbv = getValue('experienced-gbv.value');
            var scarification = getValue('scarification.value');
            var eligibility = getValue('eligible-test.value');
            var referred = getValue('referred.value');

            if(popType == false){
                getField('population-type.error').html('Please specify client population type.').show();
                return false;
            }else {
                getField('population-type.error').html('Please specify client population type.').hide();
            }
            if(department == false){
                getField('department.error').html('Please specify department.').show();
                return false;
            }else {
                getField('department.error').html('Please specify department.').hide();
            }
            if(patientType == false){
                getField('patient-type.error').html('Please specify client patient type.').show();
                return false;
            }else {
                getField('patient-type.error').html('Please specify client patient type.').hide();
            }
            if(pAge &gt; 17) {
                if (healthWorker == false) {
                    getField('health-worker.error').html('Please specify if client is a health worker.').show();
                    return false;
                } else {
                    getField('health-worker.error').html('Please specify if client is a health worker.').hide();
                }
            }
            if(relationshipChecked.length ==0){
                getField('index-error.error').html('Please specify relationship to index.').show();
                return false;
            }else {
                getField('index-error.error').html('Please specify relationship to index.').hide();
            }


            if(pgender == 'F' &amp;&amp; pAge &gt; 9 &amp;&amp; (testHistory == 1065 &amp;&amp; testStatus != 703)){
                if(patientPregnant == false ){
                    getField('pregnant.error').html('Please specify pregnancy status.').show();
                    return false;
                }else {
                    getField('pregnant.error').html('Please specify pregnancy status.').hide();
                }
            }
            if(pAge &lt; 10) {
                if (mothersStatus == false) {
                    getField('mothers-hiv-status.error').html("Please specify client mother's hiv status.").show();
                    return false;
                } else {
                    getField('mothers-hiv-status.error').html("Please specify client mother's hiv status.").hide();
                }
            }
            if(testHistory == false){
                getField('test-history.error').html('Please specify if client has been tested for HIV before.').show();
                return false;
            }else {
                getField('test-history.error').html('Please specify if client has been tested for HIV before.').hide();
            }
            if(pAge &lt; 10 &amp;&amp; mothersStatus != 703 &amp;&amp; testHistory == 1065 &amp;&amp;  testStatus != 703){
                if (everHadSex == false) {
                    getField('sexually-active.error').html('Please specify of client has ever been defiled.').show();
                    return false;
                } else {
                    getField('sexually-active.error').html('Please specify of client has ever been defiled.').hide();
                }
            }
            if(pAge &gt; 9  &amp;&amp; testHistory == 1065 &amp;&amp; testStatus != 703) {
                if (everHadSex == false) {
                    getField('sexually-active.error').html('Please specify of client has ever had sex.').show();
                    return false;
                } else {
                    getField('sexually-active.error').html('Please specify of client has ever had sex.').hide();
                }
            }
            if(pAge &gt; 9 &amp;&amp; (testHistory == 1065 &amp;&amp;  testStatus != 703)){
                if(experiencedGbv == false){
                    getField('experienced-gbv.error').html('Please specify if client has ever experienced gender based violence.').show();
                    return false;
                }else {
                    getField('experienced-gbv.error').html('Please specify if client has ever experienced gender based violence.').hide();
                }
            }
            if(pAge &lt; 10 &amp;&amp; mothersStatus != 703 &amp;&amp; testHistory == 1065 &amp;&amp;  testStatus != 703){
                if (scarification == false) {
                    getField('scarification.error').html('Please specify if client has ever had scarification, plastic tooth extraction, Circumcision, uvulectomy etc.').show();
                    return false;
                } else {
                    getField('scarification.error').html('Please specify if client has ever had scarification, plastic tooth extraction, Circumcision, uvulectomy etc.').hide();
                }
            }
            if(pAge &gt; 9 &amp;&amp; testHistory == 1065 &amp;&amp;  testStatus != 703) {
                if (scarification == false) {
                    getField('scarification.error').html('Please specify if client has ever had scarification, plastic tooth extraction, Circumcision, uvulectomy etc.').show();
                    return false;
                } else {
                    getField('scarification.error').html('Please specify if client has ever had scarification, plastic tooth extraction, Circumcision, uvulectomy etc.').hide();
                }
            }
            if((testHistory == 1065 &amp;&amp;  testStatus != 703) &amp;&amp;  (healthWorker == 1065 &amp;&amp; needleStick == false)){
                getField('needle-stick.error').html('Please specify if client had needle stick injuries.').show();
                return false;
            }else {
                getField('needle-stick.error').html('Please specify if client had needle stick injuries.').hide();
            }
            if(eligibility == false){
                getField('eligible-test.error').html('Please specify whether client is eligible for HIV test.').show();
                return false;
            }else {
                getField('eligible-test.error').html('Please specify whether client is eligible for HIV test.').hide();
            }
            if(referred == false){
                getField('referred.error').html('Please specify whether client was referred.').show();
                return false;
            }else {
                getField('referred.error').html('Please specify whether client was referred.').hide();
            }

            return true;
        });
        //Clear hidden sections
        clearHiddenSections = function(parentObj) {
            parentObj.find('input[type=radio]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=checkbox]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=text]').each(function() {
                jq(this).val("");
            });
            parentObj.find('select').each(function() {
                this.selectedIndex =0;
            });
        }

    </script>
    <ifMode mode="EDIT">
        <script type="text/javascript">
            jq(function(){

                     var populationType = getValue('population-type.value');
                    if (populationType == 164929 ){
                        jq("#key-population").show();
                        jq("#priority-population").hide();
                    }
                    if (populationType == 138643 ){
                        jq("#priority-population").show();
                        jq("#key-population").hide();
                    }
                    if(populationType == 164928){
                        jq("#key-population").hide();
                        jq("#priority-population").hide();
                    }

                   var testHistory = getValue('test-history.value');
                    if (testHistory == 1066 ){
                        jq('#test-result').hide();
                        jq('#tr-art-start-date').hide();
                        jq('#positive-client').hide();
                    }
                    if (testHistory == 1065){
                        jq('#eligible-for-test').show();
                        jq('#test-result').show();
                        jq('#tr-art-start-date').show();
                    }

                    var testStatus = getValue('ever-tested.value');
                    if (testStatus == 664 ){
                        jq('#positive-client').hide();
                    }
                    if (testStatus == 703){
                        jq('#positive-client').show();
                    }
                    if (testStatus == 1067){
                        jq('#positive-client').hide();
                    }

                    var sexuallyActive = getValue('sexually-active.value');
                    if(sexuallyActive == 'true' &amp;&amp; pAge &gt; 10) {
                        jq('#tr-sexually-active').show();
                    }  else{
                        jq('#tr-sexually-active').hide();
                    }

                    var experiencedGbv = getValue('experienced-gbv.value');
                    if(experiencedGbv == 1065) {
                        jq('#experienced-physical-violence').show();
                        jq('#sex-againist-wish').show();
                    }  else{
                        jq('#experienced-physical-violence').hide();
                        jq('#sex-againist-wish').hide();
                    }

                var healthWorker = getValue('health-worker.value');
                    if(healthWorker == 1065){
                        jq('#tr-needle-stick').show();
                    }else{
                        jq('#tr-needle-stick').hide();

                    }
                var screenedForTb = getValue('screened-tb.value');
                if(screenedForTb == 1065){
                    jq('#screening-questions').show();
                }else{
                    jq('#screening-questions').hide();

                }

                    var pwid = getValue('pwid.value');
                    var pwidChecked = jq("#pwid input:checkbox:checked");
                    if(pwid == 105 &amp;&amp; pwidChecked.length >=1){
                        jq('#tr-needle-shared').show();
                    }else{
                        jq('#tr-needle-shared').hide();
                    }
                   var referredTo = getValue('referred.value');
                    if(referredTo == 1066){
                        jq('#tr-reasons-ineligibility').show();
                    }else{
                        jq('#tr-reasons-ineligibility').hide();

                    }
                var otherReasons = getValue('other-decline-reason.value');
                var otherChecked = jq("#other-decline-reason input:checkbox:checked");
                if(otherReasons == 5622 &amp;&amp; otherChecked.length >=1){
                    jq('#tbl-other-decline-reason').show();
                }else{
                    jq('#tbl-other-decline-reason').hide();
                }

            });
        </script>
    </ifMode>

    <style>
        .simple-table {
            border: solid 1px #DDEEEE;
            border-collapse: collapse;
            border-spacing: 0;
            font: normal 13px Arial, sans-serif;
        }

        .simple-table thead th {
            background-color: #DDEFEF;
            border: solid 1px #DDEEEE;
            color: #336B6B;
            padding: 10px;
            text-align: left;
            text-shadow: 1px 1px 1px #fff;
        }

        .simple-table td {
            border: solid 1px #DDEEEE;
            color: #333;
            padding: 10px;
            text-shadow: 1px 1px 1px #fff;
        }

        .disabled {
            color: #ebebe4;
    </style>

    <div class="ke-form-header">
        <table style="width: 100%" class="simple-table">
            <tr>
                <td>
                    Screening date: <span style="color:red;"><strong>*</strong></span> <encounterDate id="encounter-date" showTime="true" required="true"/>
                </td>
                <td>HTS Provider : <encounterProvider default="currentUser" /></td>
                <td>Location: <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" /></td>
            </tr>
        </table>
    </div>

    <div class="ke-form-content">
        <!-- Population Type  -->
        <fieldset>
            <legend>Population Type</legend>
            <div>
                Population type :<span style="color:red;"><strong>*</strong></span> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                <obs conceptId="164930"
                     answerConceptIds="164928,164929,138643"
                     answerLabels="General Population,Key Population,Priority Population" id="population-type"
                     style="radio" />
            </div>
            <table id="key-population">
                <tr>
                    <td>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="105AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="People who inject drugs" style="checkbox"  id="pwid"/><br/>
                        <includeIf velocityTest="$patient.gender == 'M'">
                            <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160578AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Men who have sex with men" style="checkbox" /><br/>
                        </includeIf>
                        <includeIf velocityTest="$patient.gender == 'F'">
                            <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160579AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Female sex Worker" style="checkbox" id="female-sex-worker" /><br/>
                        </includeIf>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162277AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="People in prison and other closed settings" style="checkbox"  id="prisoner"/><br/>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="165100"
                             answerLabel="Transgender" style="checkbox"  id="transgender"/><br/>
                        <obs conceptId="160581AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Other" style="checkbox" id="other" /><br/>

                    </td>

                </tr>
            </table>
            <table id="priority-population">
                <tr>
                    <td>
                        <obs conceptId="138643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="159674AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Fisher folk" style="checkbox" /><br/>
                        <obs conceptId="138643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162198AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Truck driver" style="checkbox" /><br/>
                        <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 9) &amp;&amp; ($patient.age &lt; 25)">
                             <obs conceptId="138643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160549AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Adolescent and young girls" style="checkbox" id="adyg" /><br/>
                        </includeIf>
                        <obs conceptId="138643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="162277AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Prisoner" style="checkbox" /><br/>
                        <obs conceptId="138643AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="165192"
                             answerLabel="Military and other uniformed services" style="checkbox" id="dodOnly" /><br/>

                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>Department/Coverage</legend>
            <table class="simple-table">
                <tr>
                    <td>Department : <span style="color:red;"><strong>*</strong></span>  </td>
                    <td>
                        <obs conceptId="159936"
                             answerConceptIds="160542,5485,160473,160538,159940,163488"
                             answerLabels="OPD:Out-patient department,IPD:In-patient department,Emergency,PMTCT,VCT,Community outreach"
                             style="dropdown" id="department"/>
                    </td>
                </tr>
                <tr>
                    <td>Patient Type: <span style="color:red;"><strong>*</strong></span></td>
                    <td>
                        <obs conceptId="164956" id="patient-type"
                             answerConceptIds="164163AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,164953"
                             answerLabels="HP:Hospital Patient,NP:Non-Hospital Patient"
                             style="radio" />
                    </td>
                </tr>
                <!--Adult Questions-->
                <includeIf velocityTest="$patient.age &gt; 17">
                <tr>
                    <td>Client a health care worker? <span style="color:red;"><strong>*</strong></span></td>
                    <td>
                        <obs conceptId="5619AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" id="health-worker" />
                    </td>
                </tr>
                </includeIf>
                <tr id="index-relationship">
                    <td>Client has any relationship with an index client? <span style="color:red;"><strong>*</strong></span></td>
                    <td>
                     <excludeIf velocityTest="$patient.age &lt; 10">
                        <obs conceptId="166570AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="163565AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Sexual Contact" style="checkbox" /><br/>
                     </excludeIf>
                        <obs conceptId="166570AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="166606AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Social Contact" style="checkbox" /><br/>
                        <obs conceptId="166570AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="166517AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="Needle Sharing" style="checkbox" /><br/>
                        <obs conceptId="166570AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1107AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="None" style="checkbox" id="index-error"/><br/>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>HTS Strategy</legend>
            <table id="tbl-hts-strategy">
                <tr>
                    <td>Indicate HTS strategy used: &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs class="hts-strategy"
                             id="strategy"
                             conceptId="164956"
                             answerConceptIds="164163AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               164953,
                                               164954,
                                               164955,
                                               159938AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               159939AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               161557AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               166606AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                               5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="HP: Hospital Patient Testing,
                                           NP: HTS for non-patients,
                                           VI:Integrated VCT Center,
                                           Stand Alone VCT Center,
                                           Home Based Testing,
                                           MO: Mobile Outreach HTS,
                                           Index testing,
                                           SNS - Social Networks,
                                           O: Others"
                             required="true"
                        />
                    </td>
                    <td>
                        <table id="tbl-other-strategy">
                             <tr>
                                <td>  &#160;&#160;&#160; Specify :
                                    <obs id="other-strategy" conceptId="163761" />
                                    &#160;&#160;&#160;
                                </td>
                           </tr>
                          </table>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>History of HIV Testing</legend>
            <table class="simple-table">
                <!--HEI Questions-->
                <includeIf velocityTest="$patient.age &lt; 10">
                <tr id="mothers-status">
                    <td>
                        Mother's HIV Status : <span style="color:red;"><strong>*</strong></span>
                    </td>
                    <td>
                        <obs id="mothers-hiv-status" conceptId="1396AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="703,664,1067"
                             answerLabels="Positive,Negative,Unknown"
                             style="radio" />
                    </td>
                </tr>
                </includeIf>
                <tr>
                    <td>Tested for HIV before : <span style="color:red;"><strong>*</strong></span></td>
                    <td>
                        <obs conceptId="164401"
                             id="test-history"
                             answerConceptIds="1065,1066"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                    <td>
                        <table id="test-result">
                            <tr id="testResult">
                                <td> Who performed the test?:</td>
                                <td>
                                    <obs conceptId="165215"
                                         answerConceptIds="5619AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,164952"
                                         answerLabels="HTS Provider,Self Tested"
                                         style="radio"  id="tester"  answerSeparator="&lt;br /&gt;&lt;br /&gt;" />
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td>
                        <table>
                            <tr id="tr-art-start-date">
                                <td>
                                    Test Result :
                                    <obs id="ever-tested" conceptId="159427"
                                         answerConceptIds="703,664,1067"
                                         answerLabels="Positive,Negative,Unknown"
                                         style="dropdown" />
                                </td>
                                <td> Date Tested:
                                    <obs id="date-tested" conceptId="164400" />
                                    <span class="value"><recentObs conceptId="164400AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></span>


                                </td>
                                <td>
                                <table id="positive-client">
                                    <tr>
                                        <td width="250">Client started on ART:
                                                <obs conceptId="165240"
                                                     id="started-art"
                                                     answerConceptIds="1065,1066"
                                                     answerLabels="Yes,No" />
                                            </td>
                                            <td> CCC Number:
                                                <obs class="upn" conceptId="162053" id="upn-concept" size ="20" />
                                                <span id="upnError" class="error"></span>
                                            </td>
                                    </tr>
                                </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset id="fs-risk-assessment">
            <legend>Risk Assessment</legend>
            <div>
                Client Sexual Behaviour Assessment:
            </div>
            <table class="simple-table">
                <tr>
                    <includeIf velocityTest="$patient.age &lt; 10">
                    <td>Has the child ever been defiled?  <span style="color:red;"><strong>*</strong></span></td>
                    </includeIf>
                    <includeIf velocityTest="$patient.age &gt; 9">
                    <td>Has the client ever had sex?  <span style="color:red;"><strong>*</strong></span></td>
                    </includeIf>
                    <td>
                        <obs conceptId="5569AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="yes_no" id="sexually-active" />
                    </td>
                </tr>
            </table>
            <table class="simple-table" id="tr-sexually-active">
                <tr>
                    <td>Is the client sexually active?</td>
                    <td>
                        <obs conceptId="160109AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" id="active-sexually" />
                    </td>
                </tr>
                <tr>
                    <td>Has the client had a new sexual partner in the last 3 months?</td>
                    <td>
                        <obs conceptId="167144AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" id="new-partner"/>
                    </td>
                </tr>
                <tr>
                    <td>Partner HIV status</td>
                    <td>
                        <obs conceptId="1436AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             id="partner-hiv-status"
                             answerConceptIds="703AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,664AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="HIV Positive,HIV Negative,Unknown" style="radio"/>
                    </td>
                </tr>
                <tr>
                    <td>Discordant Couple </td>
                    <td>
                        <obs id="couple-discordant" conceptId="6096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No"/>
                    </td>
                </tr>
                <tr>
                    <td>Have you engaged in unprotected sex with more than one sexual partner in the last 12 months?  </td>
                    <td> <obs id="multiple-sex-partners" conceptId="5568AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="yes_no"/>
                        </td>
                    <td> How many sexual partners? </td>
                            <td> <obs id="no-sex-partners" conceptId="5570AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>  </td>
                </tr>
                <tr>
                    <td>Does the client engage in sex under the influence of alcohol/drugs? </td>
                    <td>
                        <obs id="alcoholic-sex" conceptId="165088"
                             answerConceptIds="1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1385AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,165027"
                             style="radio" answerLabels="Not at all,Sometimes,Always"/>
                    </td>
                </tr>
                <tr>
                    <td>Have you ever had unprotected sex in exchange of money or other material gains?</td>
                    <td>
                        <obs id="money-sex" conceptId="160579AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No"/>
                    </td>
                </tr>
                <tr>
                    <td>Have you recently had any incident of condom burst?</td>
                    <td>
                        <obs id="condom-burst" conceptId="166559AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No"/>
                    </td>
                </tr>
                <tr>
                    <td>Have you engaged in unprotected sex with someone you don’t know their HIV status in the last 12 months?
                        &#160;&#160;&#160;&#160;
                     </td>
                    <td>
                        <obs id="stranger-sex" conceptId="159218AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No"/>
                    </td>
                </tr>
                <tr>
                    <td>Have you had unprotected sex with someone who has known HIV positive status? ?</td>
                    <td>
                        <obs id="known-positive" conceptId="163568AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="163289AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No"/>
                    </td>
                </tr>
            </table>
            <excludeIf velocityTest="$patient.age &lt; 10">
            <table class="simple-table">
                <tr>
                    <td>Has the client recently experienced GBV? <span style="color:red;"><strong>*</strong></span></td>
                    <td>
                        <obs id="experienced-gbv" conceptId="167161"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No"/>
                    </td>
                </tr>
                <tr id="experienced-physical-violence">
                    <td>
                    <obs conceptId="167145AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                         answerLabel="Sexual violence" style="checkbox" id="sexual-violence" /><br/>
                    <obs conceptId="160658AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                         answerLabel="Emotional abuse" style="checkbox" id="emotional-violence" /><br/>
                    <obs conceptId="165205" answerConceptId="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                         answerLabel="Physical violence" style="checkbox" id="physical-violence"/><br/>
                    </td>
                </tr>
             </table>
            </excludeIf>
            <table class="simple-table">
                <tr>
                    <td>Has the client received any of the following services recently?</td>
                </tr>
                <!--Adult Questions-->
                <includeIf velocityTest="$patient.age &gt; 14">
                <tr>
                    <td>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs conceptId="165269" answerConceptId="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="PrEP" style="checkbox" id="prep-service" /><br/>
                    </td>
                    <td>Is the client currently on PrEP? </td>
                    <td>
                        <obs conceptId="165203"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No" id="currently-prep"/>
                    </td>
                </tr>
                </includeIf>
                <tr>
                    <td>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs conceptId="164845AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptId="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="PEP" style="checkbox" id="pep-service" />
                    </td>
                    <td>Has the client used PEP in the last 3 months?  </td>
                    <td>
                        <obs conceptId="1691AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="yes_no"  id="currently-pep" />
                    </td>
                </tr>
                <tr>
                    <td>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs conceptId="165098"
                             answerConceptId="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="STI" style="checkbox" id="sti-service" />
                    </td>
                    <td>Has the client had an STI in the last 3 months?  </td>
                    <td>
                        <obs conceptId="165200"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No" id="currently-sti"/>
                    </td>
                </tr>
                <tr>
                    <td>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        <obs conceptId="112141AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptId="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabel="TB" style="checkbox" id="tb-service" />
                    </td>
                    <td>Has the client been screened for TB? </td>
                    <td>
                        <obs conceptId="165197"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No" id="screened-tb"/>
                    </td>
                </tr>
            </table>
            <table class="simple-table" id="screening-questions">

                    <obsgroup groupingConceptId="166661AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                        <tr>
                            <td>Cough of any duration:  &#160;&#160; </td>
                            <td><obs conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " answerConceptIds="159799AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="radio" answerLabels="Yes,No" id="scr-cough" /></td>
                        </tr>
                        <tr>
                            <td>Fever: &#160;&#160;</td>
                            <td><obs conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " answerConceptIds="1494AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="radio" answerLabels="Yes,No" id="scr-fever" /></td>

                        </tr>
                        <tr>
                            <td>Noticeable weight loss or poor weight gain: &#160; </td>
                            <td><obs conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " answerConceptIds="832AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="radio" answerLabels="Yes,No" id="scr-weight" /></td>
                        </tr>
                        <!--Adult Questions-->
                        <includeIf velocityTest="$patient.age &gt; 15">
                            <tr>
                                <td>Night sweats: &#160;&#160;</td>
                                <td><obs conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " answerConceptIds="133027AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="radio" answerLabels="Yes,No" id="scr-sweat" /></td>
                            </tr>
                        </includeIf>
                        <!--Paed Questions-->
                        <includeIf velocityTest="$patient.age &lt; 16">
                            <tr>
                                <td>Contact with a TB Case: &#160;&#160;</td>
                                <td><obs conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " answerConceptIds="124068AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="radio" answerLabels="Yes,No" id="scr-contact"/></td>
                            </tr>
                            <tr>
                                <td>Lethergy, less playful than usual: &#160;&#160;</td>
                                <td><obs conceptId="1729AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=" " answerConceptIds="116334AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="radio" answerLabels="Yes,No" id="scr-lethergy" /></td>
                            </tr>
                        </includeIf>
                    </obsgroup>
                    <tr>
                        <td>
                            Resulting TB Status:
                        </td>
                    <td colspan="3">
                        <obs id="tb-result-status" conceptId="1659AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" labelText=""
                                                   answerConceptIds="1660AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                     142177AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                     1662AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="No TB Signs,Presumed TB,TB Confirmed" />
                    </td>
                  </tr>
            </table>
            <table class="simple-table">

                <tr id="tr-needle-shared">
                    <td>Have you ever shared a needle while injecting drugs with someone else?</td>
                    <td>
                        <obs conceptId="165090"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No" id="needle-shared"/>
                    </td>
                </tr>
                <tr id="tr-needle-stick">
                    <td>Has the client had needle stick injuries? <span style="color:red;"><strong>*</strong></span></td>
                    <td>
                        <obs conceptId="165060"
                             answerConceptIds="153574AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No" id="needle-stick"/>
                    </td>
                </tr>
                <tr>
                    <td>Traditional /non-medical procedures e.g. scarification, plastic tooth extraction, Circumcision, uvulectomy etc <span style="color:red;"><strong>*</strong></span></td>
                    <td>
                        <obs conceptId="166365AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"   id="scarification"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No" />
                    </td>
                </tr>
            </table>
        </fieldset>
        <includeIf velocityTest="($patient.age &lt; 10)">
        <fieldset id="fs-children-eligibility">
            <legend>Children Eligibility</legend>
            <table class="simple-table">
                <obsgroup groupingConceptId="159392AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                    <tr id="children-eligibility">
                        <td>  For children if any of the below are present , explore with the guardian and determine HTS eligibility
                            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                        </td>
                        <td>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="115122AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Malnutrition" style="checkbox" id="malnutrition" /><br/>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5050AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Failure to thrive (age and child's growth rate has discrepancy)" style="checkbox" id="growth-rate" /><br/>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="127833AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Recurrent infections" style="checkbox" id="infections" /><br/>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="112141AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="TB" style="checkbox"  id="tb-infection"/><br/>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1174AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="No parent (are orphaned)" style="checkbox" id="orphaned"/><br/>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="163718AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Parents /siblings who recently tested HIV positive" style="checkbox" id="parent-positive"/><br/>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="140238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Prolonged fever of unknown origin" style="checkbox" id="prolonged-fever"/><br/>
                            <obs conceptId="165908AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Children >18 months who are still breasteeding or wet nursing" style="checkbox" id="still-breastfeering"/><br/>
                        </td>
                    </tr>
                </obsgroup>
            </table>
        </fieldset>
        </includeIf>
        <includeIf velocityTest="($patient.gender == 'F') &amp;&amp; ($patient.age &gt; 9)">
          <fieldset id="fs-pregnancy-assessment">
            <legend>Pregnancy Assessment</legend>
            <table class="simple-table">
                <tr>
                    <td> Client currently pregnant? <span style="color:red;"><strong>*</strong></span> </td>
                    <td>
                        <obs conceptId="5272AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             style="radio" answerLabels="Yes,No" id="pregnant" />
                    </td>
                </tr>
                <tr>
                    <td> Breastfeeding mother</td>
                    <td>
                        <obs conceptId="5632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" id="breastfeeding" />
                    </td>
                </tr>
            </table>
        </fieldset>
        </includeIf>

        <fieldset>
            <legend>HIV Prediction</legend>
            <div id="div-ml-prediction">
                <table>
                    <tr>
                        <td>
                            <button type="button" class="ke-getscore-button" id="btn-ml-prediction">Get
                                risk category
                            </button>
                        </td>
                        <td width="50px"></td>
                        <td><div id="ml-prediction-risk-category"></div></td>
                        <td><div id="ml-prediction-desc" style="font-style:italic"></div></td>
                    </tr>
                    <tr style="display: none">
                        <td>
                            <obs id="algorithm_result_category"
                                 conceptId="167163AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerConceptIds="1407,1499,1408,167164"
                                 style="dropdown" />
                        </td>
                        <td>
                            <obs id="algorithm_result_score" conceptId="167162" />
                        </td>
                    </tr>
                </table>
            </div>
            <br/>
        </fieldset>

        <fieldset id="eligible-for-test">
            <legend>Eligible for Testing</legend>
            <table class="simple-table">
                <tr>
                    <td>Client eligible for testing : <span style="color:red;"><strong>*</strong></span> </td>
                    <td>
                        <obs conceptId="162699" id="eligible-test"
                             answerConceptIds="1065,1066"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <td>Client referred for testing : <span style="color:red;"><strong>*</strong></span> </td>
                    <td>
                        <obs conceptId="1788AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="referred"
                             answerConceptIds="1065,1066"
                             answerLabels="Yes,No"
                             style="radio"/>
                    </td>
                </tr>
                <obsgroup groupingConceptId="165078">
                    <tr id="tr-reasons-ineligibility">
                        <td> If No, Choose a reason below </td>
                        <td>
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="167156AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Declined testing" style="checkbox"  id="decline-testing"/><br/>
                        <includeIf velocityTest="$patient.age &gt; 9">
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="165029"
                                 answerLabel="Wants to test with partner" style="checkbox" id="wants-partner" /><br/>
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="141814AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Fear of violent partner" style="checkbox" id="violent-partner"/><br/>
                        </includeIf>
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="160589AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Stigma related issues" style="checkbox" id="stigma" /><br/>
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="155974AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="No counselor to test" style="checkbox" id="lack-counsellor" /><br/>
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="158948AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="High workload for the staff" style="checkbox" id="heavy-workload" /><br/>
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="163293AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Too sick" style="checkbox" id="too-sick"/><br/>
                            <obs conceptId="159803AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabel="Other" style="checkbox" id="other-decline-reason" /><br/>
                        </td>
                        <td>
                            <br/>
                            <table id="tbl-other-decline-reason">
                                <tr>
                                    <td>  &#160;&#160;&#160; Specify :
                                        <obs id="other-reason-specify" conceptId="160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
                                        &#160;&#160;&#160;
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </obsgroup>
            </table>
        </fieldset>

    </div>
    <div class="ke-form-footer">
        <submit/>
    </div>

</htmlform>